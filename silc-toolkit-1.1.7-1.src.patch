--- origsrc/silc-toolkit-1.1.7/Makefile.defines.in	2008-03-20 01:43:42.000000000 -0500
+++ src/silc-toolkit-1.1.7/Makefile.defines.in	2008-05-02 11:31:51.359375000 -0500
@@ -43,6 +43,7 @@
 INCLUDES = $(ADD_INCLUDES) $(SILC_CFLAGS) -DHAVE_SILCDEFS_H \
 	-I$(srcdir) -I$(top_srcdir) \
 	-I$(silc_top_srcdir) $(SILC_LIB_INCLUDES) \
+	-I$(top_builddir)/includes \
 	-I$(silc_top_srcdir)/includes \
 	-I$(silc_top_srcdir)/doc
 
--- origsrc/silc-toolkit-1.1.7/configure.ac	2008-03-20 01:43:43.000000000 -0500
+++ src/silc-toolkit-1.1.7/configure.ac	2008-05-02 11:31:51.437500000 -0500
@@ -360,23 +360,27 @@
 if test x$want_asm = xtrue; then
   AC_PATH_PROG([NASM], [nasm], [no])
   if test "x$NASM" != "xno"; then
-    if test x$cpu_x86_64 = xtrue; then
-      SILC_ASSEMBLER="$NASM -O2 -felf64"
-    else
-      SILC_ASSEMBLER="$NASM -O2 -felf"
-    fi
+    SILC_ASSEMBLER="$NASM -O2"
     have_assembler=true
   fi
 
   AC_PATH_PROG([YASM], [yasm], [no])
   if test "x$YASM" != "xno"; then
-    if test x$cpu_x86_64 = xtrue; then
-      SILC_ASSEMBLER="$YASM -Xgnu -felf64"
-    else
-      SILC_ASSEMBLER="$YASM -Xgnu -felf"
-    fi
+    SILC_ASSEMBLER="$YASM -Xgnu"
     have_assembler=true
   fi
+
+  case "$host" in
+    *-*-cygwin*|*-*-mingw*)
+      SILC_ASSEMBLER="$SILC_ASSEMBLER -fwin32"
+      ;;
+    x86_64-*)
+      SILC_ASSEMBLER="$SILC_ASSEMBLER -felf64"
+      ;;
+    *)
+      SILC_ASSEMBLER="$SILC_ASSEMBLER -felf"
+      ;;
+  esac
 fi
 AC_SUBST(SILC_ASSEMBLER)
 
@@ -1253,7 +1257,7 @@
 # Make enable-shared aware
 AM_CONDITIONAL(SILC_ENABLE_SHARED, test "$enable_shared" = yes)
 
-SILC_TOP_SRCDIR=`pwd`
+SILC_TOP_SRCDIR="`cd $srcdir; pwd`"
 
 # Included configure scripts
 #
@@ -1575,7 +1579,7 @@
 fi
 AM_CONDITIONAL(SILC_LIBTOOLFIX, test x$libtoolfix = xtrue)
 
-INCLUDE_DEFINES_INT="include \$(top_srcdir)/Makefile.defines_int"
+INCLUDE_DEFINES_INT="include \$(top_builddir)/Makefile.defines_int"
 AC_SUBST(INCLUDE_DEFINES_INT)
 
 
--- origsrc/silc-toolkit-1.1.7/includes/silc.h	2008-03-20 01:43:25.000000000 -0500
+++ src/silc-toolkit-1.1.7/includes/silc.h	2008-05-02 13:10:51.000000000 -0500
@@ -55,11 +55,11 @@
 
 /* Types */
 #define SILC_SIZEOF_LONG_LONG 8
-#define SILC_SIZEOF_LONG 8
+#define SILC_SIZEOF_LONG 4
 #define SILC_SIZEOF_INT 4
 #define SILC_SIZEOF_SHORT 2
 #define SILC_SIZEOF_CHAR 1
-#define SILC_SIZEOF_VOID_P 8
+#define SILC_SIZEOF_VOID_P 4
 
 /* Compilation time defines, for third-party software */
 #define __SILC_HAVE_PTHREAD 1
--- origsrc/silc-toolkit-1.1.7/lib/Makefile.am	2008-03-20 01:43:33.000000000 -0500
+++ src/silc-toolkit-1.1.7/lib/Makefile.am	2008-05-02 13:07:51.078125000 -0500
@@ -28,11 +28,7 @@
 # SILC Library dirs
 SILCLIB_DIRS =	contrib	silccore	silcutil	silcapputil	silccrypt	silcskr	silcmath	silcsim	silcasn1	silcske	silchttp	silcsftp	silcvcard
 if SILC_ENABLE_SHARED
-if SILC_WIN32
-LIBTOOL_OPTS= -release $(LIB_BASE_VERSION) -rpath $(DESTDIR)$(libdir) -export-dynamic -no-undefined
-else
-LIBTOOL_OPTS= -release $(LIB_BASE_VERSION) -rpath $(DESTDIR)$(libdir)
-endif
+LIBTOOL_OPTS= -release $(LIB_BASE_VERSION) -rpath $(libdir) -export-dynamic -no-undefined
 LIBTOOL_SILC_VERSION = -version-info $(LIBSILC_CURRENT):$(LIBSILC_REVISION):$(LIBSILC_AGE)
 LIBTOOL_SILCCLIENT_VERSION = -version-info $(LIBSILCCLIENT_CURRENT):$(LIBSILCCLIENT_REVISION):$(LIBSILCCLIENT_AGE)
 LIBTOOL_SILCSERVER_VERSION = -version-info $(LIBSILCSERVER_CURRENT):$(LIBSILCSERVER_REVISION):$(LIBSILCSERVER_AGE)
@@ -43,52 +39,46 @@
 LIBTOOL_SILCSERVER_VERSION =
 endif
 
-if SILC_WIN32
 SILC_LINK_LIBS=$(LIBS)
-SILCCLIENT_LINK_LIBS=$(LIBS) -lsilc
-SILCSERVER_LIBS=$(LIBS) -lsilc
-else
-SILC_LINK_LIBS=
-SILCCLIENT_LINK_LIBS=
-SILCSERVER_LIBS=
-endif
+SILCCLIENT_LINK_LIBS=$(LIBS) libsilc.la
+SILCSERVER_LIBS=$(LIBS) libsilc.la
 
-SILCLIB = libsilc.a
+SILCLIB = libsilc.la
 
 # SILC Client Library dirs
 SILCCLIENTLIB_DIRS = silcclient
-SILCCLIENTLIB = libsilcclient.a
+SILCCLIENTLIB = libsilcclient.la
 
 
 SUBDIRS = $(SILCLIB_DIRS) $(SILCSERVERLIB_DIRS) $(SILCCLIENTLIB_DIRS)
 
-CLEANFILES = libsilc.a $(SILCCLIENTLIB) $(SILCSERVERLIB)
-DISTCLEANFILES = libsilc.a $(SILCCLIENTLIB) $(SILCSERVERLIB)
+CLEANFILES = libsilc.la $(SILCCLIENTLIB) $(SILCSERVERLIB)
+DISTCLEANFILES = libsilc.la $(SILCCLIENTLIB) $(SILCSERVERLIB)
 
 remove:
 	-rm -f $(CLEANFILES)
 
 all:
-	$(MAKE) remove $(SILCLIB) $(SILCSERVERLIB) $(SILCCLIENTLIB)
+	$(MAKE) $(SILCLIB) $(SILCSERVERLIB) $(SILCCLIENTLIB)
 
 install-exec-hook:
 	-mkdir -p $(DESTDIR)$(libdir)
-	-$(LIBTOOL) $(INSTALL) libsilc.la $(DESTDIR)$(libdir)/
-	-$(LIBTOOL) $(INSTALL) libsilcclient.la $(DESTDIR)$(libdir)/
+	-$(LIBTOOL) --mode=install $(INSTALL) libsilc.la $(DESTDIR)$(libdir)/
+	-$(LIBTOOL) --mode=install $(INSTALL) libsilcclient.la $(DESTDIR)$(libdir)/
 
 LIB_BASE_VERSION=@LIB_BASE_VERSION@
 LIBSILC_CURRENT=@LIBSILC_CURRENT@
 LIBSILC_REVISION=@LIBSILC_REVISION@
 LIBSILC_AGE=@LIBSILC_AGE@
 
-libsilc.a:
+libsilc.la:
 	find $(SILCLIB_DIRS) -type f -name *.lo | xargs	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(LDFLAGS) $(SILC_LINK_LIBS)	$(LIBTOOL_SILC_VERSION)	$(LIBTOOL_OPTS) -o libsilc.la
 
 LIBSILCCLIENT_CURRENT=@LIBSILCCLIENT_CURRENT@
 LIBSILCCLIENT_REVISION=@LIBSILCCLIENT_REVISION@
 LIBSILCCLIENT_AGE=@LIBSILCCLIENT_AGE@
 
-libsilcclient.a:
+libsilcclient.la: libsilc.la
 	find $(SILCCLIENTLIB_DIRS) -type f -name *.lo | xargs	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) $(LDFLAGS)	$(SILCCLIENT_LINK_LIBS) $(LIBTOOL_SILCCLIENT_VERSION)	$(LIBTOOL_OPTS) -o libsilcclient.la
 
 
--- origsrc/silc-toolkit-1.1.7/lib/silcmath/mp_gmp.c	2008-03-20 01:43:32.000000000 -0500
+++ src/silc-toolkit-1.1.7/lib/silcmath/mp_gmp.c	2008-05-02 11:31:51.531250000 -0500
@@ -26,6 +26,13 @@
   mpz_init(mp);
 }
 
+SilcBool silc_mp_sinit(SilcStack stack, SilcMPInt *mp)
+{
+  /* XXX TODO */
+  mpz_init(mp);
+  return TRUE;
+}
+
 void silc_mp_uninit(SilcMPInt *mp)
 {
   mpz_clear(mp);
--- origsrc/silc-toolkit-1.1.7/lib/silcsim/Makefile.am	2008-03-20 01:43:26.000000000 -0500
+++ src/silc-toolkit-1.1.7/lib/silcsim/Makefile.am	2008-05-02 11:31:51.593750000 -0500
@@ -36,7 +36,7 @@
 #
 # SILC Ciphers to be compiled as modules
 #
-SIM_CIPHER_OBJS =        none.o        blowfish.o        aes.o        rsa.o        twofish.o
+SIM_CIPHER_OBJS =        none.o        blowfish.o        aes.o        twofish.o
 
 #
 # SILC Hash Functions to be compiled as modules
@@ -47,19 +47,21 @@
 all: $(SIM_CIPHER_OBJS) $(SIM_HASH_OBJS)
 endif
 
+LTFLAGS = -module -avoid-version -no-undefined -shrext .so
 if SILC_LIBTOOLFIX
-LTFLAGS = --libtool-enable-shared
-else
-LTFLAGS =
+LTFLAGS += --libtool-enable-shared
 endif
 
 $(SIM_CIPHER_OBJS):
-	@if test '!' -f lib$*.la ; then	  $(LIBTOOL) --mode=link $(CCLD) -rpath $(silc_modulesdir)		../silccrypt/$*.lo -o lib$*.la $(LTFLAGS);	  cd $(srcdir) && $(LN_S) -f $(srcdir)/.libs/lib$*.so		$(srcdir)/$*.sim.so;	fi
+	@if test '!' -f $*.sim.la ; then $(LIBTOOL) --mode=link $(CCLD) -rpath $(silc_modulesdir) ../silccrypt/$*.lo -o $*.sim.la $(LTFLAGS); fi
 
 $(SIM_HASH_OBJS):
-	@if test '!' -f lib$*.la ; then	  $(LIBTOOL) --mode=link $(CCLD) -rpath $(silc_modulesdir)		../silccrypt/$*.lo -o lib$*.la $(LTFLAGS);	  cd $(srcdir) && $(LN_S) -f $(srcdir)/.libs/lib$*.so		$(srcdir)/$*.sim.so;	fi
+	@if test '!' -f $*.sim.la ; then $(LIBTOOL) --mode=link $(CCLD) -rpath $(silc_modulesdir) ../silccrypt/$*.lo -o $*.sim.la $(LTFLAGS); fi
 
-CLEANFILES = *.sim.so *.la
+rsa.o:
+	@if test '!' -f $*.sim.la ; then $(LIBTOOL) --mode=link $(CCLD) -rpath $(silc_modulesdir) ../silccrypt/$*.lo ../libsilc.la -o $*.sim.la $(LTFLAGS); fi
+
+CLEANFILES = *.la
 
 include_HEADERS = silcsim.h silcsimutil.h
 
@@ -68,9 +70,9 @@
 #
 # Installation
 #
-install-data-hook:
-	-mkdir -p $(modulesdir)
-	-$(INSTALL_DATA) $(top_srcdir)/lib/silcsim/*.so $(modulesdir)/
+install-data-local:
+	mkdir -p $(modulesdir)
+	$(LIBTOOL) --mode=install $(INSTALL) *.sim.la $(modulesdir)/
 
 include $(top_srcdir)/Makefile.defines.in
 
--- origsrc/silc-toolkit-1.1.7/silcdefs.h.in	2008-03-20 01:43:43.000000000 -0500
+++ src/silc-toolkit-1.1.7/silcdefs.h.in	2008-05-02 11:35:08.906250000 -0500
@@ -285,6 +285,10 @@
 /* HAVE___VA_COPY */
 #undef HAVE___VA_COPY
 
+/* Define to the sub-directory in which libtool stores uninstalled libraries.
+   */
+#undef LT_OBJDIR
+
 /* Name of package */
 #undef PACKAGE
 
